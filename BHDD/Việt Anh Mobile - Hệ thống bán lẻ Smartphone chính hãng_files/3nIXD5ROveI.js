/*!CK:2389964297!*//*1445992514,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["BFjp6"]); }

__d("PluginPageTabKey",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={TIMELINE:"timeline",MESSAGES:"messages",EVENTS:"events"};},null,{});
__d('PagePluginMessageSender',['PagePluginEvents','PagePluginLogger','PluginPageTabKey','PagesMessageSender'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l,m;'use strict';l=babelHelpers.inherits(n,k);m=l&&l.prototype;function n(o,p,q,r){m.constructor.call(this,o,p,q,null);this.$PagePluginMessageSender1=new i(q,r);}n.prototype.__willSendMessage=function(o){this.$PagePluginMessageSender1.notify(h.page_plugin.messages.send,j.MESSAGES,{message:o});};f.exports=n;},null);
__d('PagePluginMessagesTab.react',['AbstractTextInput.react','AsyncRequest','Image.react','Keys','Layout.react','MercuryChannelHandler','MercuryIDs','MercuryParticipants','MercuryStateCheck','MercuryThreads','PagePluginEvents','PagePluginLogger','PagePluginMessageSender','PagesMessagingActionPlacement','PagesMessengerThreadDialogMixin','PluginPageTabKey','PluginSentryState','PopupWindow','React','ScrollableArea.react','XPluginPageMessagesTabSentryConfirmActionController','XPluginPageMessagesTabSentryController','XPluginPageMessagesTabSentryPopupPluginController','XUISpinner.react','cx','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){if(c.__markCompiled)c.__markCompiled();var ia=l.Column,ja=l.FillColumn,ka=z.PropTypes,la=150,ma=100,na=z.createClass({displayName:'PagePluginMessagesTab',mixins:[v],propTypes:{configHeight:ka.number.isRequired,pageID:ka.string.isRequired,refererURI:ka.string.isRequired},getInitialState:function(){var oa=this.props.userID;return {_logger:new s(this.props.pageID,this.props.refererURI),_mercuryChannelHandler:new m(oa),_mercuryStateCheck:new p(oa),_mercuryThreads:new q(oa),_messageSender:new t(oa,this.props.threadID,this.props.pageID,this.props.refererURI),allowScroll:true,canRenderLargeIcon:this.props.configHeight>=la,canRenderSmallIcon:this.props.configHeight>=ma,currentParticipant:null,isSentryPending:false,isWaitingForUserConfirmation:false,isSentryError:false,message:''};},getDefaultProps:function(){return {enableNewMessageDialog:true,pagesMessengerComposerProps:{isPageAdminNoteEnabled:false,isSavedResponseEnabled:false},enableSuggestedResponse:false};},componentDidMount:function(){this._logEventsOnLoaded();this.state._mercuryChannelHandler.turnOn();this._fetchMessages(20,(function(){setTimeout(this._scrollToBottom,0);}).bind(this));o.get(n.getParticipantIDFromUserID(this.props.userID),(function(oa){this.setState({currentParticipant:oa});}).bind(this));},_logEventsOnLoaded:function(){this.state._logger.notify(r.page_plugin.tab.render,w.MESSAGES);if(!this.state.canRenderSmallIcon)this.state._logger.notify(r.page_plugin.messages.invalid_height,w.MESSAGES,{actual_height:this.props.configHeight});},_shouldHandleMessageReceived:function(){return true;},_afterThreadReceived:function(){if(this._scrollToBottom())this.state._threadActions.markRead(this.props.threadID,u.UNKNOWN);},_launchSentryDialog:function(){var oa=this.state.message;window.notifySentryConfirm=(function(){this._onSentryDialogConfirmed(oa);window.notifySentryConfirm=undefined;}).bind(this);var pa=da.getURIBuilder().setString('page_id',this.props.pageID).setString('message',this.state.message).setString('thread_id',this.props.threadID).setString('iframe_referer',this.props.refererURI).getURI();y.open(pa,270,450);},_checkSentry:function(){this.setState({isSentryPending:true});var oa=ca.getURIBuilder().getURI();new i().setURI(oa).setMethod('POST').setData({page_id:this.props.pageID,message:this.state.message,iframe_referer:this.props.refererURI}).setHandler((function(pa){var qa=pa.payload;if(qa.result===x.CONFIRMATION_REQUIRED){this._onSentryCheckReturnsRequiresConfirmation();}else if(qa.result===x.VALID){this._onSentryCheckReturnsOK();}else this._onSentryErrorOut();}).bind(this)).setErrorHandler((function(){this._onSentryErrorOut();}).bind(this)).send();},_onSentryCheckReturnsOK:function(){this.setState({isSentryPending:false});this._sendMessage();},_onSentryCheckReturnsRequiresConfirmation:function(){this.setState({isWaitingForUserConfirmation:true,isSentryPending:false});},_onSentryErrorOut:function(){this.setState({isSentryPending:false,isSentryError:true});},_onSentryDialogConfirmed:function(oa){this.setState({isWaitingForUserConfirmation:false,isSentryPending:false,message:''});var pa=ba.getURIBuilder().getURI();new i().setURI(pa).setMethod('POST').setData({page_id:this.props.pageID,message:oa,iframe_referer:this.props.refererURI}).send();},_onTextInputKeyDown:function(event){if(event.keyCode!==k.RETURN||!this.state.message||this.state.message.length===0)return;this._checkSentry();},_sendMessage:function(){this.state._messageSender.sendMessage(this.state.message);this.setState({message:''});},_renderNoMessagesState:function(){var oa=ga._("Ch\u01b0a co\u0301 tin nh\u1eafn n\u00e0o"),pa=null;if(this.state.canRenderLargeIcon){pa=z.createElement('div',null,z.createElement(j,{src:ha('/images/pages/plugin/null-state-large.png')}),z.createElement('div',{className:"_1_ce _1_cf"},oa));}else if(this.state.canRenderSmallIcon)pa=z.createElement('div',null,z.createElement(j,{src:ha('/images/pages/plugin/null-state.png')}),z.createElement('div',{className:"_1_ce _1_cg"},oa));return (z.createElement('div',{className:"_1_ch"},z.createElement('div',{className:"_1_ci"},z.createElement('div',{className:"_1_cj"},pa))));},_renderHasMessagesState:function(){return (z.createElement(aa,{onScroll:this._onScroll,ref:'scrollContainer'},this.renderMessages()));},_renderInputPart:function(){var oa=ga._("Nh\u1eadp tin nh\u1eafn..."),pa=z.createElement(h,{disabled:this.state.isSentryPending||this.state.isWaitingForUserConfirmation||this.state.isSentryError,onChange:(function(event){return this.setState({message:event.target.value});}).bind(this),onKeyDown:this._onTextInputKeyDown,placeholder:oa,value:this.state.message});if(this.state.currentParticipant){return (z.createElement(l,{className:"_1_cn"},z.createElement(ia,{className:"_3nv8"},z.createElement(j,{className:"_4c4t",src:this.state.currentParticipant.image_src})),z.createElement(ja,null,pa),z.createElement(ia,{className:"_1lhb"+(this.state.isWaitingForUserConfirmation?' '+"_2wnh":'')+(!this.state.isWaitingForUserConfirmation&&!this.state.isSentryError?' '+"hidden_elem":''),onClick:(function(){this.state.isWaitingForUserConfirmation&&this._launchSentryDialog();}).bind(this)},z.createElement('div',{className:"_387u"}),z.createElement('div',{className:(!this.state.isWaitingForUserConfirmation?"hidden_elem":'')+(' '+"_2wni")},ga._("X\u00e1c nh\u1eadn")),z.createElement('div',{className:(!this.state.isSentryError?"hidden_elem":'')+(' '+"_2wni")},ga._("L\u1ed7i")))));}else return (z.createElement('div',{className:"_1_cn"},pa));},render:function(){return (z.createElement('div',{className:"_1_c3"},z.createElement('div',{className:"_1_ck"+(!this.state.loadingMessages?' '+"hidden_elem":'')},z.createElement(ea,{className:"_1_cl"}),z.createElement('div',{className:"_1_cm"},ga._("\u0110ang t\u1ea3i tin nh\u1eafn tr\u01b0\u1edbc..."))),!this.state.loadingMessages&&(!this.state.messages||this.state.messages.length===0)?this._renderNoMessagesState():this._renderHasMessagesState(),this._renderInputPart()));}});f.exports=na;},null);