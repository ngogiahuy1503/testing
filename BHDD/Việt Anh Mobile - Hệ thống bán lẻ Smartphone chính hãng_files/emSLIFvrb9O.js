/*!CK:3600579224!*//*1445180000,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["S8wpY"]); }

__d("StickerConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={MOBILE_LIKE_STICKER_PACK_ID:"227877430692340",GRAVEYARD_PACK_ID:"604597256247273",LIKE_STICKER_ID:"227878347358915",HOT_LIKE_SMALL_STICKER_ID:"369239263222822",HOT_LIKE_MEDIUM_STICKER_ID:"369239343222814",HOT_LIKE_LARGE_STICKER_ID:"369239383222810",MRU_STICKER_PACK:"599061016853145",SEARCH_PACK_ID:"680229632032514",SPRITE_PADDING:"24",PayloadSource:{VIEW_ACTION:"view-action"},EMOTICON_PACK_ID:"1471127876485636",DEFAULT_FRAME_RATE:83,TRAY_SIZE:64,THREAD_SIZE:120};},null,{});
__d('Sticker.react',['Arbiter','Image.react','React','ReactDOM','StickerConfig','StickerConstants','cx','emptyFunction','getElementPosition','getObjectValues','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){'use strict';if(c.__markCompiled)c.__markCompiled();var s=j.PropTypes,t=83,u=5000,v=10,w={CLICK:'click',HOVER:'hover',LOAD_AND_HOVER:'load_and_hover'},x=j.createClass({displayName:'Sticker',propTypes:{animationTrigger:s.oneOf(q(w)),customLike:s.string,forceCursorPointer:s.bool,frameCount:s.number.isRequired,frameRate:s.number,framesPerCol:s.number.isRequired,framesPerRow:s.number.isRequired,onAttachmentLoad:s.func,onStickerClick:s.func,packID:s.string,sourceURI:s.string.isRequired,sourceWidth:s.number.isRequired,sourceHeight:s.number.isRequired,spriteURI:s.string,stickerID:s.string,subscribedThreadID:s.string,testID:s.string},getInitialState:function(){return {index:0,hasAnimated:false,unsubscribeID:null};},getDefaultProps:function(){return {forceCursorPointer:false,frameRate:t,onStickerClick:o,packID:null};},componentDidMount:function(){this.props.onAttachmentLoad&&this.props.onAttachmentLoad(this.props.sourceHeight);this._stopIntervalID=0;if(this.props.animationTrigger===w.LOAD_AND_HOVER&&this.props.frameCount>1&&this.props.spriteURI)this.startAnimation();if(this.props.subscribedThreadID&&this.props.frameCount>1){var y=h.subscribe(this.props.subscribedThreadID,(function(z,aa){this.isScrolledIntoView(aa.scrollTop,aa.viewHeight,aa.top);}).bind(this));this.setState({unsubscribeID:y});}},componentWillUnmount:function(){if(this.state.unsubscribeID)h.unsubscribe(this.state.unsubscribeID);if(this.isAnimating())clearInterval(this._stopIntervalID);},isAnimating:function(){return !!this._stopIntervalID;},getWidth:function(){return Math.floor(this.props.sourceWidth);},getHeight:function(){return Math.floor(this.props.sourceHeight);},preloadSprite:function(){var y=new window.Image();y.onload=(function(){if(this.isMounted()&&!this.state.hasAnimated){this.setState({hasAnimated:true});this._stopIntervalID=setInterval(this.incrementFrameIndex,this.props.frameRate);}}).bind(this);if(l.ChatPaddedAnimatedStickerGK&&this.props.paddedSpriteURI){y.src=this.props.paddedSpriteURI;}else y.src=this.props.spriteURI;},isScrolledIntoView:function(y,z,aa){var ba=p(k.findDOMNode(this)),ca=y+ba.y-aa,da=y+z,ea=ca+ba.height;if(this.props.frameCount>1&&!this.state.hasAnimated&&ea-v<=da&&ca+v>=y)this.startAnimation();},startAnimation:function(){if(!this.state.hasAnimated&&this.props.spriteURI){this.preloadSprite();}else if(!this.isAnimating()){this.setState({hasAnimated:true});this._stopIntervalID=setInterval(this.incrementFrameIndex,this.props.frameRate);}},stopAnimation:function(){this.setState({index:0});clearInterval(this._stopIntervalID);this._stopIntervalID=0;},toggleAnimation:function(){if(this.isAnimating()){this.stopAnimation();}else this.startAnimation();},shouldStopAnimating:function(){var y=this.state.index%this.props.frameCount;if(!(y===0&&this.state.index*this.props.frameRate>u))return false;if(this.props.animationTrigger===w.CLICK)return true;return !this.state.isHovered;},incrementFrameIndex:function(){if(this.shouldStopAnimating()){this.stopAnimation();}else this.setState({index:this.state.index+1});},getStyle:function(){var y=0,z=this.props.spriteURI;if(l.ChatPaddedAnimatedStickerGK&&this.props.paddedSpriteURI){z=this.props.paddedSpriteURI;var aa=240/Math.min(this.getHeight(),this.getWidth());y=Math.floor(m.SPRITE_PADDING/aa);}var ba=this.state.index%this.props.frameCount,ca=ba%this.props.framesPerRow*(this.getWidth()+y*2)+y,da=Math.floor(ba/this.props.framesPerRow)*(this.getHeight()+y*2)+y,ea=this.props.frameCount>1&&this.props.animationTrigger===w.CLICK||this._isStickerClickable(this.props.packID),fa=this.props.forceCursorPointer||ea?'pointer':'default';if(!this.state.hasAnimated||!this.props.spriteURI){return {backgroundImage:this._isHotLike()?null:'url('+this.props.sourceURI+')',backgroundRepeat:'no-repeat',backgroundSize:this.getWidth()+'px '+this.getHeight()+'px',cursor:fa,height:this.getHeight(),width:this.getWidth()};}else return {backgroundImage:'url('+z+')',backgroundPosition:-ca+'px '+ -da+'px',backgroundSize:(this.getWidth()+y*2)*this.props.framesPerRow+'px '+(this.getHeight()+y*2)*this.props.framesPerCol+'px',cursor:fa,height:this.getHeight(),width:this.getWidth()};},_isStickerClickable:function(y){return y&&y!=m.MOBILE_LIKE_STICKER_PACK_ID&&y!=m.GRAVEYARD_PACK_ID;},onStickerClick:function(){if(!this._isStickerClickable(this.props.packID))return;if(this.props.onStickerClick)this.props.onStickerClick(this.props.packID,this.props.stickerID);},mouseLeft:function(){this.setState({isHovered:false});},mouseEntered:function(){this.setState({isHovered:true});if(!this.isAnimating())this.startAnimation();},tabFocusSelected:function(){this.setState({isHovered:true});if(!this.isAnimating())this.startAnimation();},tabFocusUnselected:function(){this.setState({isHovered:false});},render:function(){var y,z;if(this.props.animationTrigger===w.CLICK&&this.props.frameCount>1&&this.props.spriteURI){y=true;}else if((this.props.animationTrigger===w.HOVER||this.props.animationTrigger===w.LOAD_AND_HOVER)&&this.props.frameCount>1&&this.props.spriteURI)z=true;var aa=y?this.toggleAnimation:null;if(this.props.packID)aa=this.onStickerClick;var ba=this.props.className;if(this._isHotLike()){if(this.props.customLike){ba=r(ba,"_383m");return (j.createElement('div',{className:ba,'data-testid':this.props.testID,tabIndex:'0',onClick:aa,onMouseEnter:z?this.mouseEntered:null,onMouseLeave:z?this.mouseLeft:null,onFocus:this.tabFocusSelected,onBlur:this.tabFocusUnselected},j.createElement(i,{src:this.props.customLike})));}ba=r(ba,"_576q");}return (j.createElement('div',{className:ba,'data-testid':this.props.testID,tabIndex:'0',style:this.getStyle(),onClick:aa,onMouseEnter:z?this.mouseEntered:null,onMouseLeave:z?this.mouseLeft:null,onFocus:this.tabFocusSelected,onBlur:this.tabFocusUnselected}));},_isHotLike:function(){if(!!document.createElementNS&&!!document.createElementNS('http://www.w3.org/2000/svg','svg').createSVGRect)return (this.props.stickerID===m.HOT_LIKE_SMALL_STICKER_ID||this.props.stickerID===m.HOT_LIKE_MEDIUM_STICKER_ID||this.props.stickerID===m.HOT_LIKE_LARGE_STICKER_ID);return false;}});f.exports=x;},null);